<style>
  #viewbutton {
    position: absolute;
    top: 0;
    left: 0;
  }
</style>
<div id="map"></div>
<button id="viewbutton">View local GeoJSON file</button>
<script>
  var map = new UnlSdk.Map({
    container: "map",
    apiKey: "QcVw1BwU4hJJpwRlL7hq6tdDPQKr3iAG",
    vpmId: "f2880ebb-4be3-4902-8fda-feddcf6920db",
    center: [-8.3226655, 53.7654751],
    zoom: 8,
  });

  var viewbutton = document.getElementById("viewbutton");

  async function buttonClickHandler() {
    let fileHandle;
    [fileHandle] = await window.showOpenFilePicker({
      // allow only single file
      multiple: false,

      // apply filter for GeoJSON files
      types: [
        {
          description: "GeoJSON",
          accept: { "application/geo+json": [".geojson"] },
        },
      ],

      // start in download directory
      startIn: "downloads",
    });

    // get file handle and read content
    const file = await fileHandle.getFile();
    const contents = await file.text();

    // parse file as json and add as source to the map
    map.addSource("uploaded-source", {
      type: "geojson",
      data: JSON.parse(contents),
    });

    map.addLayer({
      id: "uploaded-polygons",
      type: "fill",
      source: "uploaded-source",
      paint: {
        "fill-color": "#888888",
        "fill-outline-color": "red",
        "fill-opacity": 0.4,
      },
      // filter for (multi)polygons; for also displaying linestrings
      // or points add more layers with different filters
      filter: ["==", "$type", "Polygon"],
    });
  }

  if ("showOpenFilePicker" in window) {
    viewbutton.addEventListener("click", buttonClickHandler);
  } else {
    viewbutton.innerText =
      "Your browser does not support File System Access API";
    // If you want a fallback, try <input type="file">; but this uses classical file upload
  }
</script>
